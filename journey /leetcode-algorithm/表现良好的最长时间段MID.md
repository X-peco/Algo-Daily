# â±ï¸ [è¡¨ç°è‰¯å¥½æœ€é•¿æ—¶é—´æ®µMID](https://leetcode.cn/problems/longest-well-performing-interval)

## ğŸ“‹ é¢˜ç›®æ¦‚è¿°

æ¯å¤©è¡¨ç°è‰¯å¥½çš„è¯„åˆ¤ä¾æ®æ˜¯ï¼šå½“å¤©å·¥ä½œï¼8å°æ—¶ã€‚æ±‚ä¸€ä¸ªæ—¶é—´æ®µï¼Œè¦æ±‚ï¼šè¡¨ç°è‰¯å¥½å¤©æ•°ï¼è¡¨ç°éè‰¯å¥½å¤©æ•°ï¼Œä¸”è¯¥æ—¶é—´æ®µæœ€é•¿ã€‚

---

### è¾“å‡ºç¤ºä¾‹

>**ç¤ºä¾‹ 1ï¼š**  
>**è¾“å…¥ï¼š** `hours = [9,9,6,0,6,6,9]`  
>**è¾“å‡ºï¼š** `3`  
>**è§£é‡Šï¼š** æœ€é•¿çš„è¡¨ç°è‰¯å¥½æ—¶é—´æ®µæ˜¯ `[9,9,6]`ã€‚

>**ç¤ºä¾‹ 2ï¼š**  
>**è¾“å…¥ï¼š** `hours = [6,6,6]`  
>**è¾“å‡ºï¼š** `0`

---

## ğŸ¤” æ€è€ƒ

é¦–å…ˆæˆ‘ä»¬è¦æŠŠæ¡ä»¶è½¬åŒ–ä¸ºå¯ä»¥ç”¨æ¥è¡¡é‡çš„é‡ï¼ˆè¿™ä¸ªé‡éœ€è¦èƒ½å¤Ÿæ¸…æ™°åæ˜ é¢˜ç›®è¦æ±‚ï¼‰ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®èµ‹äºˆä»·å€¼ã€‚  
è¿™é‡Œæˆ‘çš„åšæ³•æ˜¯å°†ï¼8çš„å·¥ä½œæ—¶é—´èµ‹å€¼ä¸º1ï¼Œâ‰¤8åˆ™æ˜¯-1ã€‚  
é‚£æˆ‘ä»¬é€šè¿‡è®¡ç®—è¿™ä¸€æ®µæ—¶é—´å†…æœ€ç»ˆæ•°å€¼ï¼Œå¦‚æœ=0åˆ™è¯´æ˜è‰¯å¥½å¤©æ•°ç­‰äºéè‰¯å¥½ï¼Œ>0åˆ™æ˜¯è¡¨ç°è‰¯å¥½å¤©æ•°>è¡¨ç°éè‰¯å¥½ã€‚  
è¿™é‡Œæˆ‘ä»¬åˆ©ç”¨å‰ç¼€å’Œï¼Œå·§å¦™å®ç°é€šè¿‡ä¸¤ä¸ªä¸‹æ ‡æ£€æµ‹æ˜¯å¦ç¬¦åˆæ¡ä»¶ï¼Œä¸”çŸ¥é“è¿™ä¸ªæ—¶é—´æ®µé•¿åº¦ã€‚

---

### ğŸ§  æ€ç»´é“¾

1. **æ•°æ®è½¬æ¢**  
    - **>8å°æ—¶** çš„å·¥ä½œæ—¥ â†’ **+1**ï¼ˆè¡¨ç°è‰¯å¥½ï¼‰  
    - **â‰¤8å°æ—¶** çš„å·¥ä½œæ—¥ â†’ **-1**ï¼ˆè¡¨ç°éè‰¯å¥½ï¼‰
2. **å‰ç¼€å’Œè®¡ç®—**  
    - è®¡ç®—æ¯å¤©çš„ç´¯è®¡å€¼ï¼ˆå‰ç¼€å’Œï¼‰ï¼Œç”¨äºå¿«é€Ÿåˆ¤æ–­ä»»æ„åŒºé—´çš„è¡¨ç°ã€‚  
    - **å‰ç¼€å’Œå…¬å¼**ï¼š Si = S(iâˆ’1) + ai (ai=ç¬¬iå¤©çš„èµ‹å€¼å€¼)
    ```
    ä¸‹æ ‡:    0     1      2     3     4     5     6
    èµ‹å€¼å€¼:        -1     1    -1     1     1     1 
    å‰ç¼€å’Œ:   0    -1     0    -1     0     1     2
    ```
3. **åˆ¤æ–­è§„åˆ™**  
    - Sj âˆ’ Si = 0 â†’ åŒºé—´ `[i+1, j]` å†… **è‰¯å¥½å¤©æ•° = éè‰¯å¥½å¤©æ•°**
    - Sj âˆ’ Si > 0 â†’ åŒºé—´ `[i+1, j]` å†… **è‰¯å¥½å¤©æ•° > éè‰¯å¥½å¤©æ•°**
4. **ç¤ºä¾‹**  
    - **å‰ç¼€å’Œæ•°ç»„**ï¼š `[0, -1, 0, -1, 0, 1, 2]`
    - **åŒºé—´ [2, 4]**ï¼ˆå¤©æ•°2~4ï¼‰ï¼šS4 âˆ’ S1 = 0 âˆ’ (âˆ’1) = 1 (è‰¯å¥½å¤©æ•°å¤š1å¤©)

---

## ğŸ› ï¸ å‰ç¼€å’Œçš„å®ç°

<details>
  <summary><strong>Python ä»£ç </strong></summary>

```python
class Solution(object):
    def longestWPI(self, hours):
        n = len(hours)
        # æ„é€ å‰ç¼€å’Œï¼Œè‹¥ hours[i] > 8 åˆ™è®°ä¸º +1ï¼Œå¦åˆ™ -1
        prefix = [0] * (n + 1)
        for i in range(n):
            prefix[i+1] = prefix[i] + (1 if hours[i] > 8 else -1)
```
</details>

<details>
  <summary><strong>C++ ä»£ç </strong></summary>

```cpp
class Solution {
public:
    int longestWPI(vector<int>& hours) {
        int n = hours.size();
        // æ„å»ºå‰ç¼€å’Œæ•°ç»„ï¼Œprefix[0] = 0
        vector<int> prefix(n + 1, 0);
        for (int i = 0; i < n; i++) {
            prefix[i + 1] = prefix[i] + (hours[i] > 8 ? 1 : -1);
        }
    }
};
```
</details>

---

## ğŸš€ ä¼˜åŒ–

å¾—å‡ºå‰ç¼€å’Œåï¼Œæˆ‘ä»¬åªéœ€æŒ¨ä¸ªé…å¯¹å°±å¥½äº†ï¼Œä½†æ­¤æ—¶çš„æ—¶é—´å¤æ‚åº¦å°±æ˜¯ n + (n-1) + ... + 1ï¼Œä¸º O(nÂ²)ã€‚  
é‚£æˆ‘ä»¬æ€è€ƒä¸€ä¸‹è¿˜å¯ä»¥ä»å“ªäº›è§’åº¦å‡ºå‘å»ä¼˜åŒ–ã€‚  
ç°åœ¨æˆ‘ä»¬å°†é—®é¢˜ç®€åŒ–ä¸ºäº†ï¼Œé€šè¿‡å‰åä¸¤ä¸ªä¸‹æ ‡ j å’Œ iï¼Œå¯ä»¥åŒæ—¶è·å¾—æ—¶é—´æ®µé•¿åº¦ (i-j)ï¼Œå¹¶æ£€æŸ¥æ˜¯å¦ç¬¦åˆæ¡ä»¶ (prefix[i]-prefix[j]>0)ã€‚  
æˆ‘ä»¬ä¸å¦¨æƒ³è±¡ï¼Œå¯¹äºæ¯ä¸ªå·¦ä¸‹æ ‡ jï¼Œè¦æ˜¯æœ‰ j1<j2, ä¸” prefix[j1]<prefix[j2]ï¼Œè¦æ˜¯åœ¨äºŒè€…ä¸­æ‹©å–å·¦ä¸‹æ ‡ï¼Œæ˜¯ä¸æ˜¯ prefix[j1] çš„é—¨æ§›æ›´ä½ï¼ˆprefix[i]-prefix[j1]>0ï¼‰ï¼Œä¸” i-j1 æ›´é•¿ï¼Œè¿™æ ·çœ‹ï¼Œj2 ä¾¿å¯ä»¥èˆå»äº†ã€‚  
è€Œå¯¹äº j1<j2, ä¸” prefix[j1]>prefix[j2]ï¼Œåˆ™å¯ä»¥ä¿ç•™ j2ã€‚  
å¯¹äºå³èŠ‚ç‚¹ï¼Œæˆ‘ä»¬åˆ™ä»åå¾€å‰éå†å³å¯å®ç°å°½å¯èƒ½æ‰¾åˆ°æœ€é•¿æ—¶é—´æ®µã€‚

---

### ğŸ—ï¸ ä¸‹æ ‡æ‹©å–ä¼˜åŒ–

<details>
  <summary><strong>Python ä»£ç </strong></summary>

```python
class Solution(object):
    def longestWPI(self, hours):
        n = len(hours)
        # æ„é€ å‰ç¼€å’Œï¼Œè‹¥ hours[i] > 8 åˆ™è®°ä¸º +1ï¼Œå¦åˆ™ -1
        prefix = [0] * (n + 1)
        for i in range(n):
            prefix[i+1] = prefix[i] + (1 if hours[i] > 8 else -1)
        
        # æ„é€ å•è°ƒæ ˆ
        stack = []
        for i in range(n+1):
            if not stack or prefix[i] < prefix[stack[-1]]:
                stack.append(i)
        
        max_length = 0
        # ä»åå¾€å‰éå†å¯»æ‰¾æœ€å¤§é•¿åº¦åŒºé—´
        for j in range(n, -1, -1):
            while stack and j > stack[-1] and prefix[j] > prefix[stack[-1]]:
                max_length = max(max_length, j - stack.pop())
        return max_length
```
</details>

<details>
  <summary><strong>C++ ä»£ç </strong></summary>

```cpp
class Solution {
public:
    int longestWPI(vector<int> &hours) {
        int n = hours.size();
        // æ„å»ºå‰ç¼€å’Œæ•°ç»„ï¼Œprefix[0] = 0
        vector<int> prefix(n + 1, 0);
        for (int i = 0; i < n; i++) {
            prefix[i + 1] = prefix[i] + (hours[i] > 8 ? 1 : -1);
        }
        // å•è°ƒé€’å‡æ ˆï¼Œä¿å­˜å‰ç¼€å’Œçš„ç´¢å¼•
        stack<int> mono;
        for (int i = 0; i < prefix.size(); i++) {
            if (mono.empty() || prefix[i] < prefix[mono.top()]) {
                mono.push(i);
            }
        }
        int maxLength = 0;
        // ä»åå¾€å‰éå†ï¼Œæ‰¾æœ€é•¿åŒºé—´
        for (int j = prefix.size() - 1; j >= 0; j--) {
            while (!mono.empty() && prefix[j] > prefix[mono.top()]) {
                maxLength = max(maxLength, j - mono.top());
                mono.pop();
            }
        }
        return maxLength;
    }
};
```
</details>

---

## â³ æ—¶é—´å¤æ‚åº¦ O(n)

- æ¯ä¸ªç‚¹ä¸ä¼šé‡å¤éå†ï¼Œæ•ˆç‡æé«˜ã€‚

---
